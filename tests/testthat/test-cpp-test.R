
test_that("test_basic_reader() works with multiple endians", {

  point_be <- as.raw(c(0x00, 0x00, 0x00, 0x00, 0x01, 0x40, 0x3e,
                       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x24, 0x00, 0x00, 0x00,
                       0x00, 0x00, 0x00))

  point_le <- as.raw(c(0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
                       0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
                       0x00, 0x24, 0x40))

  expect_output(test_basic_reader(point_be), "POINT \\(30 10\\)")
  expect_output(test_basic_reader(point_le), "POINT \\(30 10\\)")
  expect_output(
    expect_error(test_basic_reader(point_le[1:5]), "Reached end of RawVector input"),
    "POINT"
  )
})

test_that("test_basic_reader() works with ND points and SRID", {

  point_xy <- as.raw(c(0x01, #
                       0x01, 0x00, 0x00, 0x00, # type
                       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, # x
                       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40)) # y

  point_z <- as.raw(c(0x01,
                      0x01, 0x00, 0x00, 0x80, # type
                      0x00, 0x00, 0x00, 0x00,  0x00, 0x00, 0x3e, 0x40, # x
                      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40, # y
                      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40)) # z

  point_m <- as.raw(c(0x01,
                      0x01, 0x00, 0x00, 0x40, # type
                      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, # x
                      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40, # y
                      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40)) # m

  point_zm <- as.raw(c(0x01,
                       0x01, 0x00, 0x00, 0xc0, # type
                       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, # x
                       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40, # y
                       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, # z
                       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f)) # m

  point_s <- as.raw(c(0x01,
                       0x01, 0x00, 0x00, 0x20, # type
                       0xc7, 0x00, 0x00, 0x00, # srid
                       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, # x
                       0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40)) # y

  expect_output(test_basic_reader(point_xy), "POINT \\(30 10\\)")
  expect_output(test_basic_reader(point_z), "POINT Z \\(30 10 2\\)")
  expect_output(test_basic_reader(point_m), "POINT M \\(30 10 2\\)")
  expect_output(test_basic_reader(point_zm), "POINT ZM \\(30 10 2 1\\)")
  expect_output(test_basic_reader(point_s), "SRID=199;POINT \\(30 10\\)")
})

test_that("test_basic_reader() works simple geometries", {

  point <- as.raw(c(0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00,
                    0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
                    0x00, 0x24, 0x40))

  linestring <- as.raw(c(0x01, 0x02, 0x00, 0x00, 0x00, 0x02, 0x00,
                         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, 0x00,
                         0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40, 0x00, 0x00, 0x00, 0x00,
                         0x00, 0x00, 0x28, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x45,
                         0x40))
  # POLYGON ((35 10, 45 45, 15 40, 10 20, 35 10), (20 30, 35 35, 30 20, 20 30))
  polygon <- as.raw(c(0x01, 0x03, 0x00, 0x00, 0x00, 0x02, 0x00,
                      0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                      0x80, 0x41, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40,
                      0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x46, 0x40, 0x00, 0x00, 0x00,
                      0x00, 0x00, 0x80, 0x46, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                      0x2e, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x44, 0x40, 0x00,
                      0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40, 0x00, 0x00, 0x00, 0x00,
                      0x00, 0x00, 0x34, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x41,
                      0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x24, 0x40, 0x04, 0x00,
                      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x34, 0x40, 0x00,
                      0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, 0x00, 0x00, 0x00, 0x00,
                      0x00, 0x80, 0x41, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x41,
                      0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40, 0x00, 0x00,
                      0x00, 0x00, 0x00, 0x00, 0x34, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00,
                      0x00, 0x34, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x40))

  expect_output(test_basic_reader(point), "POINT \\(30 10\\)")
  expect_output(
    test_basic_reader(linestring),
    "LINESTRING \\(30 10, 12 42\\)"
  )
  expect_output(
    test_basic_reader(polygon),
    "POLYGON \\(\\(35 10, 45 45, 15 40, 10 20, 35 10\\), \\(20 30, 35 35, 30 20, 20 30\\)\\)"
  )
})
