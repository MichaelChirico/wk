<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lightweight Well-Known Geometry Parsing • wk</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Lightweight Well-Known Geometry Parsing">
<meta property="og:description" content="Provides a minimal R and C++ API for parsing
  well-known binary and well-known text representation of
  geometries to and from R-native formats. 
  Well-known binary is compact
  and fast to parse; well-known text is human-readable
  and is useful for writing tests. These formats are only
  useful in R if the information they contain can be 
  accessed in R, for which high-performance functions 
  are provided here.">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">wk</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.3.4.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/articles/philosophy.html">Understanding the wk C and C++ API</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/paleolimbot/wk/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="wk" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#wk" class="anchor"></a>wk</h1></div>
<!-- badges: start -->

<p>The goal of wk is to provide lightweight R, C, and C++ infrastructure for a distributed ecosystem of packages that operate on collections of coordinates. First, wk provides vector classes for points, segments, circles, rectangles, well-known text (WKT), and well-known binary (WKB). Second, wk provides a C API and set of S3 generics (<code><a href="reference/wk_void_handler.html">wk_handle()</a></code> and <code>wk_translate()</code>) for event-based iteration over vectors of geometries that allows clear separation code and distribution of responsibility among multiple packages.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the released version of wk from <a href="https://cran.r-project.org/">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"wk"</span><span class="op">)</span></code></pre></div>
<p>You can install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"paleolimbot/wk"</span><span class="op">)</span></code></pre></div>
<p>If you can load the package, you’re good to go!</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/wk/">wk</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="vector-classes" class="section level2">
<h2 class="hasAnchor">
<a href="#vector-classes" class="anchor"></a>Vector classes</h2>
<p>Use <code><a href="reference/wkt.html">wkt()</a></code> to mark a character vector as containing well-known text, or <code><a href="reference/wkb.html">wkb()</a></code> to mark a vector as well-known binary. Use <code><a href="reference/xy.html">xy()</a></code>, <code><a href="reference/xy.html">xyz()</a></code>, <code><a href="reference/xy.html">xym()</a></code>, and <code><a href="reference/xy.html">xyzm()</a></code> to create vectors of points, and <code><a href="reference/rct.html">rct()</a></code> to create vectors of rectangles. These classes have full <a href="https://vctrs.r-lib.org">vctrs</a> support and <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>/<code><a href="https://rdrr.io/r/base/format.html">format()</a></code> methods to make them as frictionless as possible working in R and RStudio.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/wkt.html">wkt</a></span><span class="op">(</span><span class="st">"POINT (30 10)"</span><span class="op">)</span>
<span class="co">#&gt; &lt;wk_wkt[1]&gt;</span>
<span class="co">#&gt; [1] POINT (30 10)</span>
<span class="fu"><a href="reference/wkb.html">as_wkb</a></span><span class="op">(</span><span class="fu"><a href="reference/wkt.html">wkt</a></span><span class="op">(</span><span class="st">"POINT (30 10)"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; &lt;wk_wkb[1]&gt;</span>
<span class="co">#&gt; [1] &lt;POINT (30 10)&gt;</span>
<span class="fu"><a href="reference/xy.html">xy</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; &lt;wk_xy[1]&gt;</span>
<span class="co">#&gt; [1] (1 2)</span>
<span class="fu"><a href="reference/rct.html">rct</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>
<span class="co">#&gt; &lt;wk_rct[1]&gt;</span>
<span class="co">#&gt; [1] [1 2 3 4]</span></code></pre></div>
</div>
<div id="generics" class="section level2">
<h2 class="hasAnchor">
<a href="#generics" class="anchor"></a>Generics</h2>
<p>The wk package is made up of readers, handlers, and filters. Readers parse the various formats supported by the wk package, handlers calculate values based on information from the readers (e.g., translating a vector of geometries into another format), and filters transform information from the readers (e.g., transforming coordinates) on the fly. The <code><a href="reference/wk_void_handler.html">wk_handle()</a></code> and <code>wk_translate()</code> generics power operations for many geometry vector formats without having to explicitly support each one.</p>
</div>
<div id="c-api" class="section level2">
<h2 class="hasAnchor">
<a href="#c-api" class="anchor"></a>C API</h2>
<p>The distributed nature of the wk framework is powered by a <a href="https://github.com/paleolimbot/wk/blob/master/inst/include/wk-v1.h">~100-line header</a> describing the types of information that parsers typically encounter when reading geometries and the order in which that information is typically organized. Detailed information is available in the <a href="https://paleolimbot.github.io/wk/dev/articles/articles/philosophy.html">C and C++ API article</a>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/wk_void_handler.html">wk_debug</a></span><span class="op">(</span>
  <span class="fu"><a href="reference/wkt.html">as_wkt</a></span><span class="op">(</span><span class="st">"LINESTRING (1 1, 2 2, 3 3)"</span><span class="op">)</span>,
  <span class="fu"><a href="reference/wk_void_handler.html">wkt_format_handler</a></span><span class="op">(</span>max_coords <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; initialize (dirty = 0  -&gt; 1)</span>
<span class="co">#&gt; vector_start: &lt;Unknown type / 0&gt;[1] &lt;0x7ffeecb08058&gt; =&gt; WK_CONTINUE</span>
<span class="co">#&gt;   feature_start (1): &lt;0x7ffeecb08058&gt;  =&gt; WK_CONTINUE</span>
<span class="co">#&gt;     geometry_start (&lt;none&gt;): LINESTRING &lt;0x7ffeecb07ec8&gt; =&gt; WK_CONTINUE</span>
<span class="co">#&gt;       coord (1): &lt;0x7ffeecb07ec8&gt; (1.000000 1.000000)  =&gt; WK_CONTINUE</span>
<span class="co">#&gt;       coord (2): &lt;0x7ffeecb07ec8&gt; (2.000000 2.000000)  =&gt; WK_ABORT_FEATURE</span>
<span class="co">#&gt; vector_end: &lt;0x7ffeecb08058&gt;</span>
<span class="co">#&gt; deinitialize</span>
<span class="co">#&gt; [1] "LINESTRING (1 1, 2 2..."</span></code></pre></div>
</div>
<div id="sf-support" class="section level2">
<h2 class="hasAnchor">
<a href="#sf-support" class="anchor"></a>sf support</h2>
<p>The wk package implements a reader and writer for sfc objects so you can use them wherever you’d use an <code><a href="reference/xy.html">xy()</a></code>, <code><a href="reference/rct.html">rct()</a></code>, <code>crc()</code>, <code>seg()</code>, <code><a href="reference/wkb.html">wkb()</a></code>, or <code><a href="reference/wkt.html">wkt()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/wk_void_handler.html">wk_debug</a></span><span class="op">(</span>
  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="reference/wk_void_handler.html">wkt_format_handler</a></span><span class="op">(</span>max_coords <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; initialize (dirty = 0  -&gt; 1)</span>
<span class="co">#&gt; vector_start: &lt;Unknown type / 0&gt;[1] &lt;0x7ffeecb0b298&gt; =&gt; WK_CONTINUE</span>
<span class="co">#&gt;   feature_start (1): &lt;0x7ffeecb0b298&gt;  =&gt; WK_CONTINUE</span>
<span class="co">#&gt;     geometry_start (&lt;none&gt;): LINESTRING[3] &lt;0x7ffeecb0b210&gt; =&gt; WK_CONTINUE</span>
<span class="co">#&gt;       coord (1): &lt;0x7ffeecb0b210&gt; (1.000000 1.000000)  =&gt; WK_CONTINUE</span>
<span class="co">#&gt;       coord (2): &lt;0x7ffeecb0b210&gt; (2.000000 2.000000)  =&gt; WK_ABORT_FEATURE</span>
<span class="co">#&gt; vector_end: &lt;0x7ffeecb0b298&gt;</span>
<span class="co">#&gt; deinitialize</span>
<span class="co">#&gt; [1] "LINESTRING (1 1, 2 2..."</span></code></pre></div>
</div>
<div id="lightweight" class="section level2">
<h2 class="hasAnchor">
<a href="#lightweight" class="anchor"></a>Lightweight</h2>
<p>The wk package has one recursive dependency (<a href="https://cpp11.r-lib.org">cpp11</a>), compiles in ~10 seconds, and runs all 600 expectations in ~4 seconds. The package can read and write WKB at approximately the same speed as the sf package.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"shape/nc.shp"</span>, package <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">geometry</span>
<span class="va">nc_wkb</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/wkb.html">as_wkb</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span>

<span class="fu">bench</span><span class="fu">::</span><span class="fu">mark</span><span class="op">(</span>
  <span class="fu"><a href="reference/wk_void_handler.html">wk_handle</a></span><span class="op">(</span><span class="va">nc</span>, <span class="fu"><a href="reference/wk_void_handler.html">wkb_writer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/class.html">unclass</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_binary.html">st_as_binary</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 x 6</span>
<span class="co">#&gt;   expression                         min   median `itr/sec` mem_alloc `gc/sec`</span>
<span class="co">#&gt;   &lt;bch:expr&gt;                    &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 wk_handle(nc, wkb_writer())     89.2µs    120µs     6676.      47KB     6.95</span>
<span class="co">#&gt; 2 unclass(sf::st_as_binary(nc))  332.4µs    389µs     2023.      52KB     4.19</span>

<span class="fu">bench</span><span class="fu">::</span><span class="fu">mark</span><span class="op">(</span>
  <span class="fu"><a href="reference/wk_void_handler.html">wk_handle</a></span><span class="op">(</span><span class="va">nc_wkb</span>, <span class="fu"><a href="reference/wk_void_handler.html">sfc_writer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html">st_as_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span><span class="op">(</span><span class="va">nc_wkb</span>, class <span class="op">=</span> <span class="st">"WKB"</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 x 6</span>
<span class="co">#&gt;   expression                                        min median `itr/sec`</span>
<span class="co">#&gt;   &lt;bch:expr&gt;                                      &lt;bch&gt; &lt;bch:&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 wk_handle(nc_wkb, sfc_writer())                 251µs  290µs     2981.</span>
<span class="co">#&gt; 2 sf::st_as_sfc(structure(nc_wkb, class = "WKB")) 744µs  873µs      984.</span>
<span class="co">#&gt; # … with 2 more variables: mem_alloc &lt;bch:byt&gt;, `gc/sec` &lt;dbl&gt;</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=wk">https://​cloud.r-project.org/​package=wk</a>
</li>
<li>Browse source code at <br><a href="https://github.com/paleolimbot/wk/">https://​github.com/​paleolimbot/​wk/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/paleolimbot/wk/issues">https://​github.com/​paleolimbot/​wk/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Dewey Dunnington <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-9415-4582" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Edzer Pebesma <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-8049-7069" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://github.com/paleolimbot/wk/actions"><img src="https://github.com/paleolimbot/wk/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
<li><a href="https://codecov.io/gh/paleolimbot/wk?branch=master"><img src="https://codecov.io/gh/paleolimbot/wk/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Dewey Dunnington, Edzer Pebesma.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
